# ì£¼ì‹ ìë™ ë§¤ë§¤ ê¸°íš

ì‚¬ìš©ìë‹˜, í˜„ì¡´í•˜ëŠ” ê°€ì¥ **ê²€ì¦ëœ ìŠ¹ë¦¬ ê³µì‹(ë¯¸êµ­ 3ë°° ë ˆë²„ë¦¬ì§€ ETF + ë³€ë™ì„± ëŒíŒŒ)**ê³¼ **ìµœì‹  AI ê¸°ìˆ (Gemini)**ì„ ê²°í•©í•˜ì—¬, **[Project US-ETF-Sniper]**ì˜ ê¸°íšì„œì™€ ê°œë°œ ëª…ì„¸ì„œë¥¼ í™•ì •í•´ ë“œë¦½ë‹ˆë‹¤.

ì´ ë¬¸ì„œëŠ” **"í•œêµ­íˆ¬ìì¦ê¶Œ(KIS) í•´ì™¸ì£¼ì‹ API"**ì™€ **"Google Gemini 1.5 Flash(ë¬´ë£Œ/ê³ ì†)"**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

# ğŸ“ ë¬¸ì„œ 1. [ê¸°íšì„œ] Project US-ETF-Sniper

## 1. í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ ëª…:** US-ETF-Sniper (ë¯¸êµ­ ì£¼ì‹ ë ˆë²„ë¦¬ì§€ ETF ìë™ë§¤ë§¤ ë´‡)
- **ëª©í‘œ:** ë‚˜ìŠ¤ë‹¥/ë°˜ë„ì²´ ìƒìŠ¹ì¥ì—ì„œ **3ë°° ë ˆë²„ë¦¬ì§€(3x)**ë¡œ ìˆ˜ìµì„ ê·¹ëŒ€í™”í•˜ë˜, AIë¡œ í•˜ë½ì¥ì„ ê°ì§€í•˜ì—¬ **MDD(ìµœëŒ€ ë‚™í­)ë¥¼ ë°©ì–´**í•œë‹¤.
- **í•µì‹¬ ëŒ€ìƒ:**
    1. **TQQQ** (ProShares UltraPro QQQ) - ë‚˜ìŠ¤ë‹¥ 100 ì§€ìˆ˜ 3ë°° ì¶”ì¢…
    2. **SOXL** (Direxion Daily Semiconductor Bull 3X) - ë°˜ë„ì²´ ì§€ìˆ˜ 3ë°° ì¶”ì¢…
- **ìš´ì˜ ì‹œê°„:** ë¯¸êµ­ ì •ê·œì¥ ì‹œê°„ (í•œêµ­ ì‹œê°„ 23:30 ~ 06:00, ì„œë¨¸íƒ€ì„ ì‹œ 1ì‹œê°„ ë‹¹ê²¨ì§)

## 2. íˆ¬ì ì „ëµ (The Strategy)

ì „í†µì ì¸ í€€íŠ¸ ì „ëµì¸ **'ë³€ë™ì„± ëŒíŒŒ(VBO)'**ì— **'AI ê±°ì‹œê²½ì œ í•„í„°'**ë¥¼ ì¥ì°©í•œ í•˜ì´ë¸Œë¦¬ë“œ ì „ëµì…ë‹ˆë‹¤.

### Step 1. [Trend Filter] ì¶”ì„¸ íŒë‹¨ (ì¥ ì‹œì‘ ì „)

**"ìƒìŠ¹ì¥(Bull Market)ì—ì„œë§Œ 3ë°° ë ˆë²„ë¦¬ì§€ë¥¼ íƒ„ë‹¤."**

- **ì¡°ê±´:** í˜„ì¬ ì£¼ê°€ê°€ **20ì¼ ì´ë™í‰ê· ì„ (20MA)** ìœ„ì— ìˆëŠ”ê°€?
- **Action:**
    - ìœ„(True): ë§¤ìˆ˜ ì§„ì… ì¤€ë¹„ (Risk-On).
    - ì•„ë˜(False): ë§¤ë§¤ ì‰¬ìŒ (Cash Hold). íš¡ë³´/í•˜ë½ì¥ì—ì„œ 3ë°° ETFëŠ” ê³„ì¢Œê°€ ë…¹ê¸° ë•Œë¬¸.

### Step 2. [Entry Trigger] ì§„ì… íƒ€ì  (ìˆ˜ê¸‰ í™•ì¸)

**"ì˜¤ëŠ˜ ì¥ ì´ˆë°˜ì— ìˆ˜ê¸‰ì´ ë“¤ì–´ì˜¤ë©° ìƒìŠ¹ì„¸ë¥¼ íƒ€ëŠ”ê°€?"**

- **ê³µì‹:** ë§¤ìˆ˜ ì£¼ë¬¸ê°€ = $Today Open + (Yesterday Range \times K)$
    - $Yesterday Range = (Yesterday High - Yesterday Low)$
    - $K = 0.5$ (ë…¸ì´ì¦ˆ í•„í„°ë§ ìƒìˆ˜)
- **ì˜ë¯¸:** ì¥ ì‹œì‘ í›„ ê°€ê²©ì´ ì‹œê°€ ëŒ€ë¹„ ì¼ì • í­ ì´ìƒ ìƒìŠ¹í•˜ë©´ "ì˜¤ëŠ˜ë„ ê°„ë‹¤"ê³  ë³´ê³  ì¶”ê²© ë§¤ìˆ˜.

### Step 3. [AI Macro Filter] ì¬ë£Œ ê²€ì¦ (ì§„ì… ì§ì „)

**"ê¸°ìˆ ì  ì‹ í˜¸ê°€ ë–´ì§€ë§Œ, í˜¹ì‹œ ì˜¤ëŠ˜ íŒŒì›” ì˜ì¥ì´ ê¸ˆë¦¬ ì¸ìƒ ë°œì–¸ì„ í–ˆëŠ”ê°€?"**

- **ì—­í• :** ì°¨íŠ¸ëŠ” ë§¤ìˆ˜ë¼ê³  í•˜ì§€ë§Œ, ì•…ì¬ ë‰´ìŠ¤ê°€ í„°ì§„ ê²½ìš°ë¥¼ AIê°€ ê±¸ëŸ¬ëƒ„.
- **LLM Prompt:** ë¯¸êµ­ ì£¼ìš” ê²½ì œ ë‰´ìŠ¤(CNBC, [Investing.com](http://investing.com/) í—¤ë“œë¼ì¸)ë¥¼ Geminiì—ê²Œ ì…ë ¥.
    - *"Analyze the current US market sentiment. Is there any 'Panic Selling' risk today due to Fed or CPI data? Answer YES/NO."*
- **Action:** AIê°€ "Panic Risk"ë¼ê³  íŒë‹¨í•˜ë©´ ë§¤ìˆ˜ ì·¨ì†Œ.

### Step 4. [Exit Rule] ì²­ì‚° (ì•ˆì „ì¥ì¹˜)

- **ì†ì ˆ(Stop Loss):** ë§¤ìˆ˜ê°€ ëŒ€ë¹„ **3%** ë„ë‹¬ ì‹œ ì¦‰ì‹œ ì‹œì¥ê°€ ë§¤ë„. (íƒ€í˜‘ ì—†ìŒ)
- **ìµì ˆ(Take Profit):** íŠ¸ë ˆì¼ë§ ìŠ¤íƒ‘ ì ìš© (ê³ ì  ëŒ€ë¹„ 2~3% í•˜ë½ ì‹œ ì´ìµ ì‹¤í˜„).
- **ì¢…ê°€ ì²­ì‚°(Time Cut):** ì¥ ë§ˆê° 10ë¶„ ì „(05:50) ì „ëŸ‰ ë§¤ë„. (ì˜¤ë²„ë‚˜ì´íŠ¸ ë¦¬ìŠ¤í¬ ì œê±° - ë‚´ì¼ ì•„ì¹¨ ê°­ë½ ë°©ì§€)

---

## 3. ê¸°ìˆ  ìŠ¤íƒ ë° ë¹„ìš©

- **Broker:** í•œêµ­íˆ¬ìì¦ê¶Œ (í•´ì™¸ì£¼ì‹ API). *ìˆ˜ìˆ˜ë£Œ ìµœì €, REST API ì§€ì›.*
- **AI Engine:** Google Gemini 1.5 Flash. *ì†ë„ ë¹ ë¦„, ì˜ì–´ ë‰´ìŠ¤ í•´ì„ íƒì›”, í˜„ì¬ ë¬´ë£Œ í‹°ì–´ ì œê³µ.*
- **Language:** Python 3.10+
- **Server:** ì´ˆê¸°ì—ëŠ” ê°œì¸ PC (ë°¤ì— ì¼œë‘ ) -> ì¶”í›„ AWS í”„ë¦¬í‹°ì–´(t3.micro) ë“±ìœ¼ë¡œ ì´ì „ ê¶Œì¥.

---

# ğŸ“ ë¬¸ì„œ 2. [ê°œë°œ ëª…ì„¸ì„œ] Project US-ETF-Sniper êµ¬í˜„ ê°€ì´ë“œ

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TD
    A[Scheduler (23:30 Start)] --> B(KIS API: ì ‘ì† ë° ì”ê³ í™•ì¸)
    B --> C{Trend Check (20MA)}
    C -- No --> D[Sleep (No Trade)]
    C -- Yes --> E[Market Watch (Real-time Price)]
    E --> F{Breakout Triggered?}
    F -- Yes --> G[Gemini API: News Analysis]
    G -- Positive --> H[KIS API: Buy Order]
    G -- Negative --> I[Cancel Order]
    H --> J[Monitoring (StopLoss/Trailing)]
    J --> K[Market Close Sell-off]

```

## 2. í´ë” êµ¬ì¡°

```
US-ETF-Sniper/
â”œâ”€â”€ run_bot.py              # ë©”ì¸ ì‹¤í–‰ íŒŒì¼ (ìŠ¤ì¼€ì¤„ëŸ¬)
â”œâ”€â”€ config.py               # API Key ê´€ë¦¬ (KIS, Gemini)
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ volatility_breakout.py # ë³€ë™ì„± ëŒíŒŒ ê³„ì‚° ë¡œì§
â”‚   â””â”€â”€ technical.py        # ì´ë™í‰ê· ì„  ê³„ì‚°
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ kis_api.py          # í•œêµ­íˆ¬ìì¦ê¶Œ í•´ì™¸ì£¼ì‹ API ë˜í¼
â”‚   â”œâ”€â”€ gemini_analyst.py   # ë‰´ìŠ¤ ìˆ˜ì§‘ ë° AI íŒë‹¨
â”‚   â””â”€â”€ logger.py           # ë¡œê·¸ ê¸°ë¡
â””â”€â”€ database/
    â””â”€â”€ trading_log.db      # ë§¤ë§¤ ì¼ì§€

```

## 3. ëª¨ë“ˆë³„ ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ

### 3.1. í•œêµ­íˆ¬ìì¦ê¶Œ í•´ì™¸ì£¼ì‹ API (`modules/kis_api.py`)

í•´ì™¸ì£¼ì‹ì€ êµ­ë‚´ì£¼ì‹ê³¼ URL ì—”ë“œí¬ì¸íŠ¸ê°€ ë‹¤ë¦…ë‹ˆë‹¤. **ë‚˜ìŠ¤ë‹¥(NAS)** ì‹œì¥ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```python
import requests
import json
import time

class KisOverseas:
    def __init__(self, app_key, app_secret, acc_no, mock=True):
        self.url = "<https://openapivts.koreainvestment.com:29443>" if mock else "<https://openapi.koreainvestment.com:9443>"
        self.headers = {"content-type": "application/json"}
        # í† í° ë°œê¸‰ ë¡œì§ (ìƒëµ - í•„ìˆ˜ êµ¬í˜„ í•„ìš”)
        self.access_token = self._get_token(app_key, app_secret)

    def get_current_price(self, ticker):
        """í•´ì™¸ì£¼ì‹ í˜„ì¬ê°€ ì¡°íšŒ (NAS: ë‚˜ìŠ¤ë‹¥)"""
        path = "/uapi/overseas-price/v1/quotations/price"
        headers = {
            **self.headers,
            "authorization": f"Bearer {self.access_token}",
            "tr_id": "HHDFS00000300" # í•´ì™¸ì£¼ì‹ í˜„ì¬ê°€ TR ID
        }
        params = {
            "AUTH": "",
            "EXCD": "NAS", # ë‚˜ìŠ¤ë‹¥
            "SYMB": ticker
        }
        res = requests.get(self.url + path, headers=headers, params=params)
        return float(res.json()['output']['last']) # í˜„ì¬ê°€ ë¦¬í„´

    def buy_market_order(self, ticker, qty):
        """í•´ì™¸ì£¼ì‹ ì‹œì¥ê°€ ë§¤ìˆ˜"""
        path = "/uapi/overseas-stock/v1/trading/order"
        # *ì£¼ì˜: í•´ì™¸ì£¼ì‹ ì£¼ë¬¸ TR_IDëŠ” ëª¨ì˜/ì‹¤ì „ ë‹¤ë¦„. ë¬¸ì„œ í™•ì¸ í•„ìˆ˜.
        # ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ì‘ì„±ë¨
        data = {
            "CANO": self.acc_no_prefix,
            "ACNT_PRDT_CD": self.acc_no_suffix,
            "OVRS_EXCG_CD": "NAS",
            "PDNO": ticker,
            "ORD_QTY": str(qty),
            "OVRS_ORD_UNPR": "0", # ì‹œì¥ê°€ëŠ” 0
            "ORD_SVR_DVSN_CD": "0"
        }
        # POST ìš”ì²­ ì „ì†¡...

```

### 3.2. AI ë¶„ì„ê¸° (`modules/gemini_analyst.py`)

Geminiì—ê²Œ ë¯¸êµ­ ì‹œì¥ ìƒí™©ì„ ì˜ì–´ë¡œ ë¬¼ì–´ë´…ë‹ˆë‹¤.

```python
import google.generativeai as genai

class GeminiAnalyst:
    def __init__(self, api_key):
        genai.configure(api_key=api_key)
        self.model = genai.GenerativeModel('gemini-1.5-flash')

    def check_market_sentiment(self, news_text):
        prompt = f"""
        Act as a aggressive stock trader.
        Here are the latest news headlines regarding US Tech Market & Fed:
        {news_text}

        Critical Check:
        1. Is there any MAJOR crash signal (e.g. War, Unexpected Rate Hike)?
        2. Is the sentiment predominantly Fear?

        Reply with JSON:
        {{
            "risk_level": "HIGH" or "LOW",
            "can_buy": boolean,
            "reason": "short summary"
        }}
        """
        response = self.model.generate_content(prompt)
        return response.text # JSON íŒŒì‹± í›„ can_buy ë¦¬í„´

```

### 3.3. ì „ëµ ì‹¤í–‰ (`run_bot.py`) - ìˆ˜ë„ ì½”ë“œ

```python
def trading_loop():
    # 1. ì´ˆê¸° ì„¤ì •
    target_ticker = "TQQQ"
    kis = KisOverseas(mock=True) # ëª¨ì˜íˆ¬ìë¡œ ì‹œì‘
    ai = GeminiAnalyst()

    # 2. ì¥ ì‹œì‘ ì „ ë°ì´í„° ë¶„ì„ (23:00)
    history = kis.get_daily_ohlc(target_ticker)
    ma20 = history['close'].rolling(20).mean()

    # 3. ì¶”ì„¸ í•„í„° (20ì¼ì„  ìœ„ì— ìˆì„ ë•Œë§Œ ê°€ë™)
    if history['close'][-1] = target_price:
            # AI í•„í„°ë§
            news = get_us_news() # í¬ë¡¤ë§ í•¨ìˆ˜ í•„ìš”
            sentiment = ai.check_market_sentiment(news)

            if sentiment['can_buy']:
                kis.buy_market_order(target_ticker, qty=10)
                monitor_profit_loss() # ìµì ˆ/ì†ì ˆ ê°ì‹œ ëª¨ë“œë¡œ ì „í™˜
                break # ì˜¤ëŠ˜ ì§„ì… ë
            else:
                print(f"ğŸš« AI ì§„ì… ê±°ë¶€: {sentiment['reason']}")
                break

        time.sleep(1) # 1ì´ˆ ëŒ€ê¸°

    # 6. ì¥ ë§ˆê° ì²­ì‚°
    kis.sell_all(target_ticker)

```

## 4. ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­ (Checklist)

1. **í•œêµ­íˆ¬ìì¦ê¶Œ:**
    - ê³„ì¢Œ ê°œì„¤ ë° **[í•´ì™¸ì£¼ì‹ ê±°ë˜ ì‹ ì²­]** ì™„ë£Œ.
    - **[í•´ì™¸ì£¼ì‹ ì‹¤ì‹œê°„ ì‹œì„¸]** ì‹ ì²­ (í•„ìˆ˜, ë¯¸ì‹ ì²­ ì‹œ 15ë¶„ ì§€ì—° ì‹œì„¸ë¡œ ì£¼ë¬¸ ì‹¤íŒ¨í•¨).
    - í™ˆí˜ì´ì§€ì—ì„œ Open API ì‹ ì²­ (ëª¨ì˜íˆ¬ì ì²´í¬).
2. **Google AI Studio:**
    - API Key ë°œê¸‰ (Gemini 1.5 Flash).
3. **ê°œë°œ í™˜ê²½:**
    - VS Code ì„¤ì¹˜.
    - Python 3.10 ì„¤ì¹˜.

ì´ ë¬¸ì„œëŠ” ê°œë°œìê°€ ë°”ë¡œ ì½”ë”©ì„ ì‹œì‘í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ìœ¼ë¡œ êµ¬ì²´í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´, ë°¤ì‚¬ì´ì— ì£¼ë¬´ì‹œëŠ” ë™ì•ˆ AIê°€ ëŒ€ì‹  ì¼í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.